ChatGPS Documentation
=====================

Start with the [Introduction](Introduction.md) to browse the documentation.

## About this documentation

The documentation for ChatGPS is simply the set of markdown files tracked under this directory within the repository. It consists of two main components:

* Static documentation located in the [current directory](.): These are manually authored files focused on conceptual and scenario-based topics.
* [Command reference](CommandReference.md): The command reference provides detailed documentation of each command exposed by ChatGPS. These files are generated by automation that uses the inline PowerShell comment-based help within each command's source code.

## How to build the documentation

No special action is required to build documentation because documentation is generated by default with the standard `dotnet build` command used to build this project. Generated documentation in the form of markdown files is output to the untracked directory [testdocs](../testdocs). Specific markdown files from [this directory](.) are copied to the output directory, and for each of the module's commands there is a markdown file with the help for that file listed under a `commands` subdirectory.

This build step is also executed for pull requests by this repository's continuous integration pipeline, so if you cause a build break in this step, the CI phase will replicate it and block the merge of your branch until the break is resolved.

### Browse generated documentation

You can view the documentation generated by the build simply by browsing to the output directory [testdocs](../testdocs). You can use ad hoc browsing to validate specific documentation changes or formatting this way, and of course there is also the possibility of adding automated tests that validate the generated help files.

The files use relative hyperlink paths, so even through their location is not canonical, you should still be able to browse the files on your local build system and with a markdown viewer follow links the same way one would with the actual published documentation in the repository.

### Disabling doc builds for speedup

Documentation generation is fairly simple, but can still add nearly 30s to a build on an average system, so for local builds you can temporarily disable documentation generation if you're not planning on publishing documentation changes by running the following command from the **root of this repository**:

```powershell
& ./ChatGPS/build/Set-DocBuildDisabled.ps1 -Disabled
```

Once you run this command, the documentation build target will be a no-op. The effect only lasts for the current PowerShell session, so if you start a new PowerShell session and invoke a build in it, you'll first need to re-execute the documentation disabling command if you still want to skip documentation generation.

You can also undo the disabled state within the current PowerShell session by executing the same script and explicitly setting the switch paramter to `$false`:

```powershell
& ./ChatGPS/build/Set-DocBuildDisabled.ps1 -Disabled:$false
```

If you'd like to see whether documentation build is currently disabled or not, use this command:

```powershell
& ./ChatGPS/build/Is-DocBuildDisabled.ps1
```

It will output `True` if documentation build is disabled, `False` otherwise.

## How to publish the documentation

As noted above, the output of the documentation portion of the build is sent to local, untracked directory. Actual documentation lives under this project's [docs](.) directory, so an explicit steps must be taken to update the documents there and push them to the repository:

1. Build the project as normal with `dotnet build`; review the documentation at `ChatGPS/testdocs` to see if change are needed, and repeat step 1 if you do make changes.
2. Execute the [Publish-Documentation](../build/Publish-Documentation.ps1) script and specify the path to the generated module's output directory with the `ModulePath` parameter AND the `Production` parameter; without the last parameter, documentation will still end up in the `testdocs` directory, not the desired tracked directory. Be sure to use the output path of the build from the first step!
3. Use standard `git` commands to add and commit the generated files under [docs](.)
4. Review the documentation changes locally; if updates are required, you'll need to go back to step 1 and rebuild, and also repeat step 2.
5. Push the branch with your favorite `git` tool -- you can then view and evaluate the changes on Github.
6. Merge the branch to main after you've completed any revisions from your review of the changes.

After the last step, you'll be able to browse the resulting docs from `main` at https://github.com/adamedx/ChatGPS/tree/main/ChatGPS/docs, and of course as you make documentation changes you can always view them in local or remote branches in the `ChatGPS/testdocs` directory after any build.

Here is a sample command for the `Publish-Documentation` command executed from the root of the repository

```powershell
& ./build/Publish-Documentation.ps1 -ModulePath ./ChatGPS/bin/Release/net8.0/Module/ChatGPS -Production
```

Note that currently the configuration of the build used by `dotnet build` has no impact on documentation generation, so either `Debug` or `Release` should work fine for instance.

## Implementation notes for docs

This module's markdown-based documentation utilizes the [platyPS](https://www.powershellgallery.com/packages/platyPS) PowerShell module, despite the fact that this plugin has been formally superseded by the quite recently released (end of 2024) [Microsoft.PowerShell.PlatyPS](https://www.powershellgallery.com/packages/Microsoft.PowerShell.PlatyPS) module.

Both modules were considered, but the newer module fared poorly on the the ChatGPS module's requirements, which were to generate markdown help from PowerShell-based comment help -- the new `platyPS` is apparently optimized for generating fully-featured MAML help with markdown as the source. When used with PowerShell-based help, the module generated content in its output, apparently due to idiosyncrasies of the content of the ChatGPS command-based help. The original `platyPS` ran without error, though it does require some workarounds to deal with comments that themselves contain markdown (!) and also multi-line code blocks that contain empty lines.

Once the newer module is more mature and can handle comment-based help reliably, then the implementation can be changed to utilize it. Or perhaps this module will require MAML-based help or markdown instead of PowerShell comments as the authoritative documentation source; in that case the new `platyPus` would be sufficient.
